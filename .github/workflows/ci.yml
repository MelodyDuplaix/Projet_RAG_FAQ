name: CI

on:
  push:
    branches: [ main ] 

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4 
    - name: Set up Python
      uses: actions/setup-python@v4 
      with:
        python-version: 3.11 
    - name: Install uv and project dependencies
      run: |
        pip install uv
        uv sync 
    - name: Start API and test
      run: |
        uv run uvicorn src.main:app --host 0.0.0.0 --port 8000 &
        sleep 10
        uv run pytest --cov=src --cov-report=xml
